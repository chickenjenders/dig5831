<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Set Your Password</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      text-align: center;
      padding: 80px 20px;
    }

    input {
      padding: 10px;
      font-size: 16px;
      width: 300px;
      transition: width 0.3s ease;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-left: 10px;
      cursor: pointer;
    }

    .requirement {
      font-size: 18px;
      margin-top: 15px;
      transition: color 0.3s ease;
    }

    .shake {
      animation: shake 0.3s;
    }

    @keyframes shake {
      0% {
        transform: translateX(0px);
      }

      25% {
        transform: translateX(-5px);
      }

      50% {
        transform: translateX(5px);
      }

      75% {
        transform: translateX(-5px);
      }

      100% {
        transform: translateX(0px);
      }
    }

    .green {
      color: #9f9;
    }

    .red {
      color: #f99;
    }
  </style>
</head>

<body>

  <h1>Set Your Password</h1>
  <div id="requirements"></div>
  <div style="margin-top: 40px;">
    <input type="text" id="password" placeholder="Enter password here" />
    <button onclick="checkPassword()">Submit</button>
  </div>

  <script>
    const requirements = [
      { text: "Must include 3 numbers", test: p => (p.match(/\d/g) || []).length >= 3 },
      { text: "Must include 6 capital letters", test: p => (p.match(/[A-Z]/g) || []).length >= 6 },
      { text: "Must include 2 special characters", test: p => (p.match(/[^A-Za-z0-9]/g) || []).length >= 2 },
      { text: "Must include 1 prime number", test: p => /2|3|5|7/.test(p) },
      { text: "Must include 3 vowels", test: p => (p.match(/[AEIOUaeiou]/g) || []).length >= 3 },
      { text: "Must include an onomatopoeia", test: p => /(boom|bang|zap|pow|buzz)/i.test(p) },
      { text: "Must include your boss’s name", test: p => /(Malphas|malphas)/i.test(p) },
      { text: "Must include one apology (e.g., 'sorry')", test: p => /sorry/i.test(p) },
      { text: "Must include a date in MM/DD format", test: p => /(0[1-9]|1[0-2])\/([0-2][0-9]|3[01])/.test(p) },
      { text: "Must include at least one lowercase letter", test: p => /[a-z]/.test(p) },
      { text: "Must end with a period", test: p => /\.$/.test(p) },
      { text: "Must begin and end with a special character", test: p => /^[^A-Za-z0-9].*[^A-Za-z0-9]$/.test(p) },
      { text: "Must contain at least one repeated letter", test: p => /(.)\1/.test(p) },
      { text: "Must include the word 'password' somewhere but not at the start", test: p => /password/i.test(p) && !/^password/i.test(p) },
      { text: "Must include at least one star (*)", test: p => /\*/.test(p) },
      { text: "Must include at least one unnecessary underscore (_)", test: p => /_/.test(p) },
      { text: "Must have an odd total number of characters", test: p => p.length % 2 === 1 },
      { text: "Must make your password symmetrical (same forwards/backwards)", test: p => p === p.split('').reverse().join('') },
      { text: "You'll never remember that, just make your password 'password'", test: p => p === "password" },
      { text: "Wait, that password sucks! It’s so unsecure… make it 'password123!'", test: p => p === "password123!" }
    ];

    let current = 0;
    const reqContainer = document.getElementById("requirements");
    const input = document.getElementById("password");

    // Display the first requirement
    addRequirement(requirements[current].text);

    // Expand input as user types
    input.addEventListener("input", () => {
      const len = input.value.length;
      input.style.width = Math.min(300 + len * 10, 800) + "px";
    });

    // Submit on Enter key
    input.addEventListener("keydown", function (event) {
      if (event.key === "Enter") checkPassword();
    });

    function addRequirement(text) {
      const p = document.createElement("p");
      p.textContent = text;
      p.className = "requirement";
      reqContainer.appendChild(p);
    }

    function checkPassword() {
      // trim whitespace so accidental leading/trailing spaces don't break exact matches
      const password = input.value.trim();
      const reqElements = document.querySelectorAll(".requirement");

      // Special handling for final 2 requirements
      const isFinalStep = current >= requirements.length - 2;

      if (isFinalStep) {
        const finalReq = requirements[current];
        if (password === (current === 18 ? "password" : "password123!")) {
          const p = reqElements[current];
          p.classList.remove("red", "shake");
          p.classList.add("green");

          if (current < requirements.length - 1) {
            current++;
            addRequirement(requirements[current].text);
          } else {
            showWelcomeToHell();
          }
        } else {
          const p = reqElements[current];
          p.classList.remove("green");
          p.classList.add("red", "shake");
          setTimeout(() => p.classList.remove("shake"), 500);
        }
        return;
      }

      // Regular requirement checking for steps 0–17
      let allPassed = true;
      for (let i = 0; i <= current; i++) {
        const req = requirements[i];
        const el = reqElements[i];
        if (req.test(password)) {
          el.classList.remove("red", "shake");
          el.classList.add("green");
        } else {
          el.classList.remove("green");
          el.classList.add("red", "shake");
          allPassed = false;
          setTimeout(() => el.classList.remove("shake"), 500);
        }
      }

      // Reveal next requirement if all passed
      if (allPassed && current < requirements.length - 1) {
        current++;
        addRequirement(requirements[current].text);
      }
    }

    // keep the welcome function at top-level scope so it's unambiguous and callable
    function showWelcomeToHell() {
      document.body.innerHTML = `
    <h1 style='font-size:80px; color:#f44; margin-top:20vh;'>WELCOME TO HELL!</h1>
    <a href="manual.html"><button id="reviewManual">Review Manual</button></a>
  `;
    }
  </script>

</body>

</html>