<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infernal Affairs - Shift Scheduler</title>
  <style>
    body {
      background: linear-gradient(135deg, #1a1625, #2d1b3d);
      color: #e0e0e0;
      font-family: 'Inter', sans-serif;
      margin: 0;
      overflow-x: hidden;
    }

    header {
      background: #0f0a1a;
      border-bottom: 2px solid #8b5cf6;
      padding: 20px 40px;
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      color: #c084fc;
      font-size: 22px;
    }

    .container {
      display: grid;
      grid-template-columns: 250px 1fr 300px;
      gap: 20px;
      padding: 30px;
    }

    /* Sidebar */
    .demon-list {
      background: rgba(15, 10, 26, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 10px;
      padding: 15px;
      height: fit-content;
    }

    .demon-item {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: 0.2s;
    }

    .demon-item:hover {
      background: rgba(139, 92, 246, 0.25);
    }

    .demon-item.locked {
      opacity: 0.5;
      cursor: not-allowed;
      position: relative;
    }

    .demon-item.locked::after {
      content: 'ðŸ”’';
      position: absolute;
      right: 10px;
      top: 10px;
      font-size: 14px;
    }

    /* Schedule Area */
    .schedule-area {
      background: rgba(15, 10, 26, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 12px;
      padding: 25px;
    }

    .shifts {
      display: flex;
      justify-content: space-between;
      gap: 16px;
    }

    .shift-column {
      flex: 1;
      background: rgba(139, 92, 246, 0.05);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .shift-column h3 {
      text-align: center;
      color: #c084fc;
      margin-bottom: 12px;
    }

    .task-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .task-item {
      background: rgba(139, 92, 246, 0.15);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 6px;
      padding: 10px;
      font-size: 14px;
    }

    .drop-slot {
      border: 2px dashed rgba(139, 92, 246, 0.3);
      border-radius: 6px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      cursor: pointer;
      transition: 0.2s;
    }

    .drop-slot.drag-over {
      border-color: #c084fc;
      background: rgba(139, 92, 246, 0.1);
    }

    .drop-slot.filled {
      background: rgba(139, 92, 246, 0.2);
      border-color: #8b5cf6;
      color: #fff;
    }

    /* Task Pool */
    .task-pool {
      background: rgba(15, 10, 26, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 10px;
      padding: 20px;
      height: fit-content;
    }

    .pool-task {
      background: rgba(139, 92, 246, 0.15);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 10px;
      cursor: move;
      font-size: 13px;
    }

    .pool-task.used {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* Submit Bar */
    .submit-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(15, 10, 26, 0.9);
      border-top: 2px solid #8b5cf6;
      text-align: center;
      padding: 15px;
    }

    .submit-btn {
      background: linear-gradient(135deg, #8b5cf6, #c084fc);
      border: none;
      border-radius: 6px;
      color: #fff;
      padding: 12px 40px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }

    .submit-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: #1e1b2e;
      border: 2px solid #8b5cf6;
      border-radius: 12px;
      padding: 30px;
      width: 400px;
      text-align: center;
    }

    /* vertical schedule list and insertion marker */
    .task-list-vertical {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px;
      max-width: 720px;
      margin: 0 auto;
    }

    .task-item.baseline {
      padding: 10px 12px;
      background: rgba(139, 92, 246, 0.12);
      border-radius: 6px;
    }

    .task-item.assigned-task {
      background: linear-gradient(90deg, rgba(139, 92, 246, 0.16), rgba(139, 92, 246, 0.22));
      border-radius: 6px;
      padding: 10px 12px;
      cursor: move;
    }

    .insertion-marker {
      height: 8px;
      background: rgba(192, 132, 252, 0.25);
      border-radius: 4px;
      margin: 4px 0;
      transition: all 140ms ease;
      transform-origin: left center;
    }

    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      bottom: 28px;
      background: rgba(30, 27, 46, 0.95);
      color: #e9e4ff;
      border: 1px solid rgba(139, 92, 246, 0.4);
      padding: 10px 16px;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
      opacity: 0;
      pointer-events: none;
      transition: opacity 180ms ease, transform 180ms ease;
      z-index: 1200;
    }

    .toast.active {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
      pointer-events: auto;
    }

    /* Profile card shown above the schedule when a demon is selected */
    .profile-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(139, 92, 246, 0.08);
      padding: 10px 12px;
      border-radius: 8px;
      margin: 12px 0;
      color: #e7def8;
      text-align: center;
    }

    .profile-item {
      background: rgba(139, 92, 246, 0.06);
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 13px;
      color: #f3e9ff;
    }
  </style>
</head>

<body>
  <header>
    <h1>Infernal Affairs â€” Demon Shift Scheduler</h1>
  </header>

  <div class="container">
    <div class="demon-list" id="demonList"></div>
    <div class="schedule-area" id="scheduleArea">
      <p style="color:#9ca3af; text-align:center;">Select a demon to view schedule</p>
    </div>
    <div class="task-pool" id="taskPool"></div>
  </div>

  <div class="submit-bar">
    <button class="submit-btn" id="submitBtn" disabled>Submit Schedule</button>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <h2 id="modalTitle" style="color:#c084fc"></h2>
      <p id="modalBody"></p>
      <button class="submit-btn" onclick="closeModal()">Close</button>
    </div>
  </div>

  <!-- Welcome / instructions modal shown on page load -->
  <div class="modal" id="welcomeModal">
    <div class="modal-content">
      <h2 style="color:#c084fc">Welcome to Infernal Affairs</h2>
      <p style="color:#e0e0e0; text-align:left;">Your job: assign one optional task to each of the three shifts for the
        selected demon.<br><br>
        How to play:
      <ul style="text-align:left; color:#d1c0f8;">
        <li>Choose a demon from the left.</li>
        <li>Drag an optional task from the right into the single empty slot for each shift.</li>
        <li>Fill all three slots to enable the Submit button and view the shift report.</li>
      </ul>
      </p>
      <label style="display:flex;align-items:center;gap:8px;justify-content:center;margin-top:8px;color:#cfc1ff;"><input
          type="checkbox" id="hideWelcomeCheckbox"> Don't show this again</label>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:center;">
        <button class="submit-btn" onclick="closeWelcomeModal()">Got it</button>
      </div>
    </div>
  </div>

  <!-- toast element for brief messages -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
   const demons = [
      { id: 'gerald', name: 'Gerald Finch', dept: 'IT', baseline: ['Answer IT ticket emails', 'Attend standup meeting', 'Update the new updates article nobody reads', 'Clean up legacy code', 'Review bug tickets'], optional: ['Attend to 12 tickets for demons needing assistance restarting their computer', 'Unplug and replug HR departmentâ€™s printers (27)', 'Review code project merge requests with no comments', 'Complete mandatory internet safety training', 'Write a 10-page report on why the Wi-Fi crashed last week', 'Train an intern to close tabs (there are 187 open)'], misery: [9, 7, 10, 8, 7, 10], causeOfDeath: 'Fell asleep at the wheel after working 3 days consecutively', sentence: 'Sold soul for middle management position', bloodType: 'A+', mbti: 'ISTJ', astro: 'Virgo', aspects: ['Low patience', 'Arrogant', 'Hates ambiguity'] },
      { id: 'cheryl', name: 'Cheryl Stone', dept: 'Sales', baseline: ['Strategy meeting with team', 'Answer emails', 'Review recent contracts', 'Follow up on potential clients', 'Organize new client leads'], optional: ['Data entry in silence', 'Reorganize files alphabetically', 'Complete Manipulation training until reaching a perfect score', 'Solo shift at the crossroads', 'Shadow the new hireâ€™s first soul deal', 'Present quarterly projections to an empty conference room for â€œpractice.â€'], misery: [10, 8, 6, 10, 4, 10], causeOfDeath: 'Old age', sentence: 'Sold soul in exchange for ex-husbandâ€™s fortune', bloodType: 'O-', mbti: 'ENFP', astro: 'Leo', aspects: ['Charismatic', 'People-pleaser', 'Hates to be alone'] },
      { id: 'marcus', name: 'Marcus Webb', dept: 'HR', baseline: ['Review incoming applicants', 'Conduct second stage interviews', 'Deny PTO requests', 'Complete mandatory customer service training', 'Respond to all emails'], optional: ['Announce new decaf policy in the break room', 'Hold handling meeting for coworkers causing disruption during work', 'Update 200 outdated policies that no one reads', 'Organize a grief circle for demons demoted to Floor 404', 'Address all complaints from the complaint box by assuming who made the complaints', 'Prepare 100 laminated â€œTeamwork is Eternalâ€ posters'], misery: [10, 10, 6, 8, 10, 5], causeOfDeath: 'Got in between violent argument of two coworkers', sentence: 'Contributed nothing to society', bloodType: 'B+', mbti: 'INFJ', astro: 'Capricorn', aspects: ['Overly formal', 'Rule-oriented', 'Hates conflict and confrontation'] }
    ];


    let state = { current: null, assignments: {}, locked: {} };

    function init() {
      const list = document.getElementById('demonList');
      demons.forEach(d => {
        const el = document.createElement('div');
        el.className = 'demon-item';
        el.innerHTML = `<strong>${d.name}</strong><br><small>${d.dept}</small>`;
        el.onclick = () => selectDemon(d.id);
        list.appendChild(el);
      });
      // show welcome on first load unless hidden
      if (localStorage.getItem('hideWelcome') !== 'true') showWelcomeModal();
    }

    function selectDemon(id) {
      if (state.locked[id]) return;
      state.current = demons.find(d => d.id === id);
      renderSchedule();
      renderTasks();
      document.getElementById('submitBtn').disabled = true;
    }

    function renderSchedule() {
      const d = state.current; const area = document.getElementById('scheduleArea');
      // Build a small profile card with helpful context for the player
      const profileHtml = `
        <div class="profile-card">
          <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;">
            <div class="profile-item"><strong>Cause of death:</strong> ${d.causeOfDeath}</div>
            <div class="profile-item"><strong>Sentence:</strong> ${d.sentence}</div>
            <div class="profile-item"><strong>Blood type:</strong> ${d.bloodType}</div>
          </div>
          <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:8px;">
            <div class="profile-item"><strong>MBTI:</strong> ${d.mbti}</div>
            <div class="profile-item"><strong>Astro:</strong> ${d.astro}</div>
            <div class="profile-item"><strong>Aspects:</strong> ${d.aspects.join(', ')}</div>
          </div>
        </div>`;

      // Render baseline tasks once as a vertical list. Players may drop optional tasks
      // from the pool between any two items; up to 3 optional tasks may be assigned.
      area.innerHTML = `<h2 style='color:#c084fc;text-align:center;'>${d.name} â€” ${d.dept}</h2>
      ${profileHtml}
      <div class='task-list-vertical' id='scheduleList'>
        ${d.baseline.map((t, i) => `<div class='task-item baseline' data-baseline-index='${i}'>${t}</div>`).join('')}
      </div>
      <p style='text-align:center;color:#9ca3af;margin-top:8px;'>Drag up to 3 optional tasks from the right into the list above. Drop between items to insert.</p>`;

      // Attach drag/drop listeners to the schedule list container
      const scheduleList = document.getElementById('scheduleList');
      scheduleList.ondragover = listDragOver;
      scheduleList.ondrop = listDrop;
      scheduleList.ondragleave = listDragLeave;

      // restore any previously-saved assignments for this demon
      const saved = state.assignments[d.id] || [];
      saved.forEach(idx => {
        const poolTask = document.querySelector(`.pool-task[data-index='${idx}']`);
        // if poolTask not yet rendered, we'll mark used after renderTasks runs
      });
    }

    function renderTasks() {
      const pool = document.getElementById('taskPool');
      const d = state.current; pool.innerHTML = '<h3>Optional Tasks</h3>';
      d.optional.forEach((t, i) => {
        const el = document.createElement('div');
        el.className = 'pool-task'; el.textContent = t;
        el.draggable = true; el.dataset.index = i;
        el.ondragstart = dragStart;
        el.tabIndex = 0;
        el.onkeydown = poolKeyDown;
        pool.appendChild(el);
      });
      // allow dropping back into the pool to unassign tasks
      pool.ondragover = (e) => e.preventDefault();
      pool.ondrop = dropToPool;
      // mark any pool items used by current assignments
      markPoolUsed();
      // also restore assigned elements in order
      const scheduleList = document.getElementById('scheduleList');
      if (scheduleList) {
        // remove any existing assigned-task elements
        Array.from(scheduleList.querySelectorAll('.assigned-task')).forEach(a => a.remove());
        const saved = state.assignments[state.current.id] || [];
        saved.forEach(idx => {
          const t = d.optional[idx];
          if (t == null) return;
          const newEl = document.createElement('div');
          newEl.className = 'task-item assigned-task';
          newEl.textContent = t;
          newEl.draggable = true;
          newEl.dataset.index = idx;
          newEl.tabIndex = 0;
          newEl.onkeydown = assignedKeyDown;
          newEl.ondragstart = dragStart;
          newEl.ondragend = dragEnd;
          // animate restoration of saved assigned items
          newEl.style.opacity = 0; newEl.style.transform = 'translateY(6px)';
          scheduleList.appendChild(newEl);
          requestAnimationFrame(() => { newEl.style.transition = 'opacity 160ms ease, transform 160ms ease'; newEl.style.opacity = 1; newEl.style.transform = ''; });
        });
        checkReady();
      }
    }

    let dragged = null; // the element being dragged
    let dragSource = null; // 'pool' or 'assigned'
    let insertionMarker = null;

    function ensureMarker() {
      if (!insertionMarker) {
        insertionMarker = document.createElement('div');
        insertionMarker.className = 'insertion-marker';
      }
    }
    function clearMarker() {
      if (insertionMarker && insertionMarker.parentElement) insertionMarker.parentElement.removeChild(insertionMarker);
    }

    function dragStart(e) {
      dragged = e.target;
      if (!dragged) return;
      if (dragged.classList.contains('pool-task')) dragSource = 'pool';
      else if (dragged.classList.contains('assigned-task')) dragSource = 'assigned';
      else dragSource = null;
      // Give a bit of transparency while dragging
      setTimeout(() => dragged && (dragged.style.opacity = '0.6'), 0);
    }

    function dragEnd(e) {
      if (dragged) dragged.style.opacity = '';
      dragged = null; dragSource = null;
      clearMarker();
    }

    // keyboard: Enter on pool to assign to end (if space), Arrow up/down/delete on assigned
    function poolKeyDown(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        const el = e.currentTarget;
        // attempt to append to schedule
        const assignedCount = document.querySelectorAll('.assigned-task').length;
        if (assignedCount >= 3) { showToast('You may only assign up to 3 optional tasks.'); return; }
        const scheduleList = document.getElementById('scheduleList');
        if (!scheduleList) return;
        const newEl = document.createElement('div');
        newEl.className = 'task-item assigned-task';
        newEl.textContent = el.textContent;
        newEl.draggable = true;
        newEl.dataset.index = el.dataset.index;
        newEl.tabIndex = 0;
        newEl.onkeydown = assignedKeyDown;
        newEl.ondragstart = dragStart;
        newEl.ondragend = dragEnd;
        // animate append
        newEl.style.opacity = 0; newEl.style.transform = 'translateY(6px)';
        scheduleList.appendChild(newEl);
        requestAnimationFrame(() => { newEl.style.transition = 'opacity 160ms ease, transform 160ms ease'; newEl.style.opacity = 1; newEl.style.transform = ''; });
        el.classList.add('used');
        saveAssignments();
        checkReady();
      }
    }

    function assignedKeyDown(e) {
      const el = e.currentTarget;
      if (!el) return;
      if (e.key === 'Delete' || e.key === 'Backspace') {
        // unassign
        const idx = el.dataset.index;
        const poolTask = document.querySelector(`.pool-task[data-index='${idx}']`);
        if (poolTask) poolTask.classList.remove('used');
        if (el.parentElement) el.parentElement.removeChild(el);
        saveAssignments();
        checkReady();
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        const prev = el.previousElementSibling;
        if (prev) el.parentElement.insertBefore(el, prev);
        saveAssignments();
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        const next = el.nextElementSibling;
        if (next) el.parentElement.insertBefore(next, el);
        saveAssignments();
      }
    }

    // list drag handlers: compute insertion point and show marker
    function listDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      const list = e.currentTarget;
      ensureMarker();

      // compute insertion spot skipping any existing marker nodes
      const children = Array.from(list.children).filter(c => !c.classList || !c.classList.contains('insertion-marker'));
      let insertBeforeEl = null;
      for (const child of children) {
        const rect = child.getBoundingClientRect();
        const mid = rect.top + rect.height / 2;
        if (e.clientY < mid) { insertBeforeEl = child; break; }
      }

      // place marker at computed spot
      clearMarker();
      if (insertBeforeEl) list.insertBefore(insertionMarker, insertBeforeEl);
      else list.appendChild(insertionMarker);
    }

    function listDragLeave(e) {
      // remove the insertion marker when leaving the list
      clearMarker();
    }

    function listDrop(e) {
      e.preventDefault();
      const list = e.currentTarget;
      if (!dragged) { clearMarker(); return; }

      // If dragging from pool, ensure max 3 assigned
      const assignedCount = document.querySelectorAll('.assigned-task').length;
      if (dragSource === 'pool' && assignedCount >= 3) {
        // simple feedback via toast
        showToast('You may only assign up to 3 optional tasks.');
        dragEnd();
        return;
      }

      // Use the marker position (if present) as the insertion point
      const marker = insertionMarker && insertionMarker.parentElement === list ? insertionMarker : null;

      if (dragSource === 'pool') {
        // create a new assigned element
        const newEl = document.createElement('div');
        newEl.className = 'task-item assigned-task';
        newEl.textContent = dragged.textContent;
        newEl.draggable = true;
        newEl.dataset.index = dragged.dataset.index; // preserve misery index
        newEl.tabIndex = 0;
        newEl.onkeydown = assignedKeyDown;
        newEl.ondragstart = dragStart;
        newEl.ondragend = dragEnd;
        // animate insertion
        newEl.style.opacity = 0; newEl.style.transform = 'translateY(6px)';
        if (marker) list.insertBefore(newEl, marker);
        else list.appendChild(newEl);
        requestAnimationFrame(() => { newEl.style.transition = 'opacity 160ms ease, transform 160ms ease'; newEl.style.opacity = 1; newEl.style.transform = ''; });
        // mark pool item used
        dragged.classList.add('used');
        // persist assignments
        saveAssignments();
      } else if (dragSource === 'assigned') {
        // moving an existing assigned element within the list
        // if marker is directly after dragged, nothing to do
        if (marker && marker.nextSibling === dragged) { dragEnd(); return; }
        if (marker) list.insertBefore(dragged, marker);
        else list.appendChild(dragged);
      }

      clearMarker();
      checkReady();
      saveAssignments();
    }

    function dropToPool(e) {
      e.preventDefault();
      const pool = e.currentTarget;
      if (!dragged) return;
      // if removing an assigned task, remove it and unmark pool item
      if (dragged.classList.contains('assigned-task')) {
        const idx = dragged.dataset.index;
        // find pool-task with same index
        const poolTask = document.querySelector(`.pool-task[data-index='${idx}']`);
        if (poolTask) poolTask.classList.remove('used');
        // remove the assigned element from schedule
        if (dragged.parentElement) dragged.parentElement.removeChild(dragged);
        checkReady();
        saveAssignments();
      }
      dragEnd();
    }

    // show a small toast message
    let toastTimer = null;
    function showToast(msg, ms = 1800) {
      const t = document.getElementById('toast');
      if (!t) return; t.textContent = msg; t.classList.add('active');
      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(() => { t.classList.remove('active'); toastTimer = null; }, ms);
    }

    function checkReady() {
      const assigned = document.querySelectorAll('.assigned-task').length;
      document.getElementById('submitBtn').disabled = assigned < 3;
    }

    // persist assigned tasks per-demon in state and localStorage
    function saveAssignments() {
      if (!state.current) return;
      const assignedEls = Array.from(document.querySelectorAll('.assigned-task'));
      const arr = assignedEls.map(el => el.dataset.index);
      state.assignments[state.current.id] = arr;
      // only persist if user opted in
      if (localStorage.getItem('rememberAssignments') === 'true') {
        try { localStorage.setItem('assignments', JSON.stringify(state.assignments)); } catch (e) { /* ignore */ }
      }
    }

    function loadAssignments() {
      try {
        const raw = localStorage.getItem('assignments');
        if (raw) state.assignments = JSON.parse(raw);
      } catch (e) { state.assignments = {}; }
    }

    function markPoolUsed() {
      // mark pool tasks used based on current state's saved assignments
      const d = state.current;
      if (!d) return;
      // clear any used flags first
      document.querySelectorAll('.pool-task').forEach(t => t.classList.remove('used'));
      const arr = state.assignments[d.id] || [];
      arr.forEach(idx => {
        const poolTask = document.querySelector(`.pool-task[data-index='${idx}']`);
        if (poolTask) poolTask.classList.add('used');
      });
    }

    // (remember-schedule toggles removed in reverted UI)

    document.getElementById('submitBtn').onclick = () => {
      const d = state.current; let misery = 0;
      document.querySelectorAll('.assigned-task').forEach(z => {
        const i = z.dataset.index; misery += d.misery[i];
      });
      const avg = Math.round((misery / 30) * 100);
      state.locked[d.id] = true;
      document.querySelectorAll('.demon-item').forEach(el => { if (el.innerText.includes(d.name)) el.classList.add('locked'); });
      showModal(`${d.name}'s Shift Report`, `Misery Index: ${misery} / 30<br>Efficiency: ${avg}%<br><br>Report filed to Central Torment Division.`);
    };

    function showModal(title, body) {
      document.getElementById('modalTitle').innerHTML = title;
      document.getElementById('modalBody').innerHTML = body;
      document.getElementById('modal').classList.add('active');
    }
    function closeModal() { document.getElementById('modal').classList.remove('active'); }

    // Welcome modal handlers
    function showWelcomeModal() {
      document.getElementById('welcomeModal').classList.add('active');
    }
    function closeWelcomeModal() {
      const cb = document.getElementById('hideWelcomeCheckbox');
      if (cb && cb.checked) localStorage.setItem('hideWelcome', 'true');
      document.getElementById('welcomeModal').classList.remove('active');
    }
    init();
  </script>
</body>

</html>