<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Infernal Affairs — Shift Scheduler</title>
  <style>
    :root {
      --ink: #eadfd2;
      --bg: #1a1625;
      --panel: #140f20;
      --line: #3a2a52;
      --accent: #a788ff;
      --accent-2: #caa3ff;
      --muted: #9487b5;
      --danger: #ff7b7b;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      background: linear-gradient(135deg, #1a1625, #2d1b3d);
      color: var(--ink)
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 22px;
      border-bottom: 2px solid var(--accent);
      background: #0f0a1a;
      box-shadow: 0 6px 24px rgba(167, 136, 255, .25)
    }

    h1 {
      font-size: 18px;
      letter-spacing: .6px;
      margin: 0;
      color: var(--accent)
    }

    .meta {
      display: flex;
      gap: 20px;
      font-size: 13px;
      color: var(--muted)
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      grid-template-columns: 260px 1fr 320px;
      gap: 18px
    }

    /* left: demons */
    .card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 14px
    }

    .demons h2,
    .pool h2 {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: .7px;
      color: var(--muted);
      margin: 0 0 10px
    }

    .demon {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      background: #1b142a;
      transition: all .2s
    }

    .demon:hover {
      border-color: var(--accent)
    }

    .demon.active {
      outline: 2px solid var(--accent);
      box-shadow: 0 0 0 4px rgba(167, 136, 255, .15)
    }

    .name {
      font-weight: 700;
      color: #e9e4f8
    }

    .dept {
      font-size: 12px;
      color: var(--muted)
    }

    /* center: schedule */
    .profile {
      display: none
    }

    .profile.active {
      display: block
    }

    .profile-header {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 14px;
      background: #1b142a;
      margin-bottom: 14px
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 8px
    }

    .pill {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      background: #120d1a
    }

    .pill small {
      display: block;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .5px
    }

    .pill span {
      font-size: 14px
    }

    .shift {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      background: #181226;
      margin-bottom: 12px
    }

    .shift h3 {
      margin: 0 0 10px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: .6px;
      color: var(--muted)
    }

    .row {
      display: flex;
      align-items: stretch;
      gap: 8px;
      margin: 6px 0
    }

    .baseline {
      flex: 1;
      background: #201832;
      border: 1px solid #2c2144;
      border-radius: 10px;
      padding: 10px;
      font-size: 14px;
      color: #cbbfe6
    }

    .slot {
      min-width: 140px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px dashed #3a2a52;
      border-radius: 10px;
      color: #7f70a7;
      background: #130e1d;
      padding: 6px;
      transition: all .15s
    }

    .slot.dragover {
      border-color: var(--accent);
      color: var(--accent)
    }

    .chip {
      background: #261a3f;
      border: 1px solid var(--accent);
      color: #eadfff;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 13px;
      width: 100%;
      text-align: left
    }

    /* right: task pool + submit */
    .task {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      background: #1b142a;
      cursor: grab
    }

    .task.used {
      opacity: .35;
      cursor: not-allowed;
      filter: saturate(.6)
    }

    .submit {
      margin-top: 8px;
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 0;
      color: #130e1d;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      font-weight: 800;
      cursor: pointer
    }

    .submit:disabled {
      opacity: .45;
      cursor: not-allowed
    }

    /* modal */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      place-items: center;
      background: rgba(0, 0, 0, .6);
      z-index: 50
    }

    .modal.show {
      display: grid
    }

    .panel {
      background: #130e1d;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 18px;
      width: min(560px, 92vw)
    }

    .panel h2 {
      margin: 0 0 8px
    }

    .meter {
      height: 12px;
      border-radius: 999px;
      background: #2a2040;
      overflow: hidden;
      border: 1px solid var(--line)
    }

    .bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff7b7b, #ffb36d);
      transition: width .5s
    }

    .note {
      color: var(--muted);
      font-size: 13px
    }

    .close {
      margin-top: 10px;
      display: inline-block;
      border: 1px solid var(--accent);
      color: var(--accent);
      background: transparent;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer
    }
  </style>
</head>

<body>
  <header>
    <h1>Infernal Affairs — Shift Scheduler</h1>
    <div class="meta">
      <div>Current Shift: <strong>1</strong></div>
      <div>Demons Scheduled: <strong id="doneCount">0/3</strong></div>
    </div>
  </header>

  <div class="wrap">
    <!-- DEMON LIST -->
    <section class="card demons">
      <h2>Employees</h2>
      <div id="demonList"></div>
    </section>

    <!-- SCHEDULE -->
    <section class="card">
      <div id="profileArea">
        <div class="profile empty">
          <p style="color:#9b92b8; text-align:center; padding:40px">Select an employee to arrange their three shifts.
          </p>
        </div>
      </div>
    </section>

    <!-- TASK POOL -->
    <section class="card pool">
      <h2>Optional Tasks (Drag Anywhere • Max 3)</h2>
      <div id="taskPool"></div>
      <button id="submitBtn" class="submit" disabled>Submit This Schedule</button>
    </section>
  </div>

  <!-- MODAL -->
  <div id="modal" class="modal">
    <div class="panel">
      <h2 id="reportTitle">Shift Report</h2>
      <p class="note" id="reportBlurb"></p>
      <div class="meter" style="margin:12px 0 6px">
        <div id="bar" class="bar"></div>
      </div>
      <p style="margin:6px 0 0"><strong id="scoreNum">Misery Index: 0</strong> <span class="note">• Efficiency <span
            id="effPct">0%</span></span></p>
      <button class="close" onclick="closeModal()">Close</button>
    </div>
  </div>

  <script>
    /* ---------------------------------------------------------
       DATA
    --------------------------------------------------------- */
    const DEMONS = [
      {
        id: 'gerald', name: 'Gerald Finch', dept: 'IT',
        mbti: 'ISTJ', blood: 'A+', sign: 'Virgo',
        cause: 'Stress-induced heart attack at desk',
        sentence: 'Obsessive micromanagement destroyed team morale and drove two junior developers to breakdowns.',
        personality: 'Needs clear instructions, loves documentation, hates ambiguity. Gets physically ill when requirements change mid-project.',
        // five baseline per shift (fixed order)
        shifts: [
          [
            'Answer “Why is internet slow?” emails',
            'Approve 404 incident reports',
            'Attend stand-up (no one knows what they did)',
            'Update the wiki nobody reads',
            'Patch InfernalOS Beta v666'
          ],
          [
            'Ticket triage (300 new “URGENT” flags)',
            'Printer exorcism request intake',
            'Explain caching again (fourth time)',
            'Firewall log audit for hope packets',
            'Rollback last rollback (again)'
          ],
          [
            'Nightly status export (fails silently)',
            'Compliance screenshot parade',
            'Write post-mortem before incident',
            'Meet about meetings',
            'Reboot the data center (spiritual)'
          ]
        ],
        // Optional pool (fixed for first shift)
        optional: [
          { label: 'Fix “the thing” (user cannot elaborate)', tags: ['vague'] },
          { label: 'Urgent task due yesterday with no specs', tags: ['impossible', 'vague'] },
          { label: 'Install software (user forgot password)', tags: ['loop'] },
          { label: 'Debug code you didn’t write (no comments)', tags: ['vague'] },
          { label: 'Deploy to prod Friday 4:58 PM', tags: ['impossible'] },
          { label: 'Migrate wiki to new wiki for no reason', tags: ['loop'] }
        ],
        // Weights per aversion (hidden)
        weights: { vague: 10, impossible: 9, loop: 7 }
      },
      {
        id: 'cheryl', name: 'Cheryl Stone', dept: 'Sales',
        mbti: 'ESFP', blood: 'O-', sign: 'Leo',
        cause: 'DUI crash after client dinner',
        sentence: 'Manipulated relationships purely for commission and status.',
        personality: 'Thrives on attention and social interaction. Suffers in isolation and paperwork.',
        shifts: [
          [
            'Call 50 “not interested” leads',
            'CRM “enthusiasm” updates',
            'Stand-up chant: Every No is a Future Yes',
            'Quota review (numbers increase mid-meeting)',
            'Prospect list cleanup (again)'
          ],
          [
            'Lunch & Learn (cold pizza, colder stares)',
            'Deck polishing for tomorrow’s deck',
            'Shadow pitch where you cannot speak',
            'Client “quick call” (75 minutes)',
            'Rejected expense reports review'
          ],
          [
            'Territory reshuffle (again)',
            'Leads dispute mediation',
            'Pipeline rinse (remove wins as “lucky”)',
            'Win story write-up (not your win)',
            'Nightly KPI affirmations'
          ]
        ],
        optional: [
          { label: 'Data entry alone for 6 hours', tags: ['isolation'] },
          { label: 'Listen to training video w/ headphones', tags: ['isolation'] },
          { label: 'Organize files alphabetically (solo)', tags: ['isolation'] },
          { label: 'Work from home with camera OFF all day', tags: ['isolation'] },
          { label: 'Eat lunch at desk (no visitors)', tags: ['isolation'] },
          { label: 'Cold email 200 strangers', tags: ['tedium'] }
        ],
        weights: { isolation: 10, tedium: 6 }
      },
      {
        id: 'marcus', name: 'Marcus Webb', dept: 'HR',
        mbti: 'ENFJ', blood: 'B+', sign: 'Libra',
        cause: 'Choked at mandatory work dinner',
        sentence: 'Enabled toxic culture by siding with management over workers.',
        personality: 'Pathological people-pleaser. Melts in direct conflict and bad-news delivery.',
        shifts: [
          [
            'Smile at complaint about low pay',
            'Enforce policy you think is dumb',
            'Explain “no budget for raises” (again)',
            'Onboarding souls (confetti disabled)',
            'Wellness survey compilation (0% happy)'
          ],
          [
            'Investigate anonymous complaint (it’s yours)',
            'Diversity report formatting (no data)',
            'Benefits town hall (no questions allowed)',
            'Update handbook while ignoring feedback',
            'Performance rubric rewording'
          ],
          [
            'Reconciliation of reconciliation logs',
            'Policy contradiction alignment',
            'Exit interview with soul that can’t leave',
            'Manager training: “Empathy™ Lite”',
            'Executive offsite travel approvals'
          ]
        ],
        optional: [
          { label: 'Fire someone on their birthday (scripted)', tags: ['conflict'] },
          { label: 'Break up screaming match (you in middle)', tags: ['conflict'] },
          { label: 'Announce free coffee discontinued', tags: ['badnews'] },
          { label: 'Deny PTO request for their wedding', tags: ['badnews', 'conflict'] },
          { label: 'Say no to therapy dog proposal', tags: ['badnews'] },
          { label: 'Mediation between two demons who hate you', tags: ['conflict'] }
        ],
        weights: { conflict: 10, badnews: 9 }
      }
    ];

    /* ---------------------------------------------------------
       STATE
    --------------------------------------------------------- */
    const state = {
      current: null,                // demon id
      drops: {},                   // { demonId: [ {shift:0..2, index: insertIndex, taskIdx} ... ] }
      usedTasks: {}                // { demonId: Set(taskIdx) }
    };
    DEMONS.forEach(d => { state.drops[d.id] = []; state.usedTasks[d.id] = new Set(); });

    /* ---------------------------------------------------------
       RENDER: DEMON LIST
    --------------------------------------------------------- */
    const demonListEl = document.getElementById('demonList');
    DEMONS.forEach(d => {
      const el = document.createElement('div');
      el.className = 'demon'; el.dataset.id = d.id;
      el.innerHTML = `<div class="name">${d.name}</div><div class="dept">${d.dept}</div>`;
      el.onclick = () => selectDemon(d.id, el);
      demonListEl.appendChild(el);
    });

    function selectDemon(id, el) {
      state.current = id;
      document.querySelectorAll('.demon').forEach(n => n.classList.remove('active'));
      el.classList.add('active');
      renderProfile();
      renderPool();
      toggleSubmit();
    }

    /* ---------------------------------------------------------
       RENDER: PROFILE + SHIFTS (with insertion slots)
    --------------------------------------------------------- */
    function renderProfile() {
      const host = document.getElementById('profileArea');
      host.innerHTML = '';
      const d = DEMONS.find(x => x.id === state.current);
      if (!d) { host.innerHTML = '<div class="profile"><p style="padding:24px;color:#9b92b8">Select an employee.</p></div>'; return; }

      const wrap = document.createElement('div');
      wrap.className = 'profile active';
      wrap.innerHTML = `
    <div class="profile-header">
      <div style="font-weight:800; color:#eadfff; font-size:18px">${d.name} — ${d.dept}</div>
      <div class="grid">
        <div class="pill"><small>MBTI</small><span>${d.mbti}</span></div>
        <div class="pill"><small>Blood</small><span>${d.blood}</span></div>
        <div class="pill"><small>Sign</small><span>${d.sign}</span></div>
      </div>
      <div class="grid" style="margin-top:10px">
        <div class="pill" style="grid-column:span 3"><small>Cause of Death</small><span>${d.cause}</span></div>
        <div class="pill" style="grid-column:span 3"><small>Personality</small><span>${d.personality}</span></div>
        <div class="pill" style="grid-column:span 3"><small>Hell Sentence</small><span>${d.sentence}</span></div>
      </div>
    </div>
  `;
      // shifts
      d.shifts.forEach((tasks, sIdx) => {
        const sec = document.createElement('section');
        sec.className = 'shift';
        sec.innerHTML = `<h3>Shift ${sIdx + 1}</h3>`;
        // For each baseline task, add [slot | baseline] rows, plus a slot at the end
        tasks.forEach((t, i) => {
          sec.appendChild(makeRow(d.id, sIdx, i));               // slot before
          const base = document.createElement('div');
          base.className = 'baseline';
          base.textContent = t;
          const row = document.createElement('div'); row.className = 'row';
          row.appendChild(base);
          sec.appendChild(row);
        });
        sec.appendChild(makeRow(d.id, sIdx, tasks.length));       // trailing slot
        wrap.appendChild(sec);
      });

      host.appendChild(wrap);
      // rehydrate already placed chips
      reapplyChips();
    }

    function makeRow(demonId, shiftIdx, insertIndex) {
      const row = document.createElement('div'); row.className = 'row';
      const slot = document.createElement('div'); slot.className = 'slot';
      slot.textContent = 'Insert task here';
      slot.dataset.demon = demonId;
      slot.dataset.shift = shiftIdx;
      slot.dataset.index = insertIndex;

      slot.ondragover = (e) => { e.preventDefault(); slot.classList.add('dragover'); };
      slot.ondragleave = () => slot.classList.remove('dragover');
      slot.ondrop = (e) => {
        e.preventDefault(); slot.classList.remove('dragover');
        const taskIdx = Number(e.dataTransfer.getData('taskIdx'));
        placeTask(demonId, shiftIdx, insertIndex, taskIdx, slot);
      };
      row.appendChild(slot);
      return row;
    }

    /* ---------------------------------------------------------
       RENDER: TASK POOL (fixed per demon)
    --------------------------------------------------------- */
    function renderPool() {
      const pool = document.getElementById('taskPool');
      pool.innerHTML = '';
      const d = DEMONS.find(x => x.id === state.current);
      if (!d) { pool.innerHTML = `<div class="task" style="opacity:.5">Select an employee first</div>`; return; }

      d.optional.forEach((opt, idx) => {
        const used = state.usedTasks[d.id].has(idx);
        const t = document.createElement('div');
        t.className = `task ${used ? 'used' : ''}`;
        t.textContent = opt.label;
        if (!used) {
          t.draggable = true;
          t.ondragstart = (e) => { e.dataTransfer.setData('taskIdx', String(idx)); };
        }
        pool.appendChild(t);
      });
    }

    /* ---------------------------------------------------------
       PLACE TASK (max 3 per demon, anywhere)
    --------------------------------------------------------- */
    function placeTask(demonId, shiftIdx, insertIndex, taskIdx, slotEl) {
      // Enforce cap = 3
      if (state.usedTasks[demonId].size >= 3 && !state.usedTasks[demonId].has(taskIdx)) {
        pulse(slotEl, 'You already assigned 3 tasks.');
        return;
      }
      // Prevent duplicate use of same option
      if (state.usedTasks[demonId].has(taskIdx)) {
        pulse(slotEl, 'That task is already placed.');
        return;
      }
      // Record
      state.drops[demonId].push({ shift: shiftIdx, index: insertIndex, taskIdx });
      state.usedTasks[demonId].add(taskIdx);

      // Render chip into slot
      slotEl.innerHTML = '';
      const chip = document.createElement('button');
      chip.className = 'chip';
      chip.textContent = DEMONS.find(d => d.id === demonId).optional[taskIdx].label + '  ✕';
      chip.onclick = () => removeTask(demonId, shiftIdx, insertIndex, taskIdx);
      slotEl.appendChild(chip);
      slotEl.classList.add('filled');
      renderPool();
      toggleSubmit();
    }

    function removeTask(demonId, shiftIdx, insertIndex, taskIdx) {
      // remove from record
      state.drops[demonId] = state.drops[demonId].filter(r => !(r.shift === shiftIdx && r.index === insertIndex && r.taskIdx === taskIdx));
      state.usedTasks[demonId].delete(taskIdx);
      // re-render profile to clear chip from slot
      renderProfile();
      renderPool();
      toggleSubmit();
    }

    function reapplyChips() {
      const d = DEMONS.find(x => x.id === state.current);
      state.drops[d.id].forEach(r => {
        const slot = document.querySelector(`.slot[data-demon="${d.id}"][data-shift="${r.shift}"][data-index="${r.index}"]`);
        if (slot) {
          slot.innerHTML = '';
          const chip = document.createElement('button');
          chip.className = 'chip';
          chip.textContent = d.optional[r.taskIdx].label + '  ✕';
          chip.onclick = () => removeTask(d.id, r.shift, r.index, r.taskIdx);
          slot.appendChild(chip);
          slot.classList.add('filled');
        }
      });
    }

    /* ---------------------------------------------------------
       SUBMIT & REPORT (per demon)
    --------------------------------------------------------- */
    function toggleSubmit() {
      const btn = document.getElementById('submitBtn');
      const d = DEMONS.find(x => x.id === state.current);
      if (!d) { btn.disabled = true; return; }
      btn.disabled = !(state.usedTasks[d.id].size === 3);
    }

    document.getElementById('submitBtn').onclick = () => {
      const d = DEMONS.find(x => x.id === state.current);
      const placed = Array.from(state.usedTasks[d.id]);
      const score = placed.reduce((sum, idx) => {
        const tags = d.optional[idx].tags || [];
        let add = 0;
        tags.forEach(tag => add += (d.weights[tag] || 5));
        return sum + add;
      }, 0);
      // 3 tasks × ~max(10 per tag); normalize to %
      const eff = Math.round(Math.min(100, (score / 30) * 100));
      const blurb = narrative(d, placed, eff);

      // mark demon as completed (prevents resubmitting)
      const card = document.querySelector(`.demon[data-id="${d.id}"]`);
      card.style.opacity = .6;

      // done count
      const done = DEMONS.filter(x => state.usedTasks[x.id].size === 3).length;
      document.getElementById('doneCount').textContent = `${done}/${DEMONS.length}`;

      showReport(`${d.name} — Schedule Submitted`, blurb, score, eff);
    };

    function narrative(demon, placedIdx, eff) {
      // pick the strongest tag used to tailor blurb
      const tagScore = {};
      placedIdx.forEach(i => {
        (demon.optional[i].tags || []).forEach(t => {
          tagScore[t] = (tagScore[t] || 0) + (demon.weights[t] || 5);
        });
      });
      const top = Object.entries(tagScore).sort((a, b) => b[1] - a[1])[0]?.[0] || 'tedium';
      const lines = {
        vague: `${demon.name} visibly recoiled at ambiguity. Documentation rituals have failed to prevent suffering.`,
        impossible: `Deadlines mocked the living and the dead alike. ${demon.name} spiraled at the impossible timeline.`,
        loop: `Procedural recursion achieved. ${demon.name} is now trapped in a comforting circle of futility.`,
        isolation: `${demon.name} with no audience: catastrophic. Echoes of silence amplified despair.`,
        tedium: `Repetition did the work. ${demon.name} learned that boredom is a blade.`,
        conflict: `Direct confrontation melted ${demon.name} into a puddle of apologies.`,
        badnews: `Delivering disappointment siphoned hope with clinical efficiency.`
      };
      const tone =
        eff >= 90 ? 'Exceptional torment wrapped in plausible productivity. Management will be… pleased.' :
          eff >= 75 ? 'Satisfactory suffering with room for sharper edges.' :
            eff >= 60 ? 'Below expectations — review aversions and escalate cruelty tactfully.' :
              'Alarmingly humane. Retraining recommended (or reassignment to Floor 404).';
      return `${lines[top] || 'Efficient malaise achieved.'} ${tone}`;
    }

    function showReport(title, blurb, score, eff) {
      document.getElementById('reportTitle').textContent = title;
      document.getElementById('reportBlurb').textContent = blurb;
      document.getElementById('scoreNum').textContent = `Misery Index: ${score}`;
      document.getElementById('effPct').textContent = `${eff}%`;
      const bar = document.getElementById('bar');
      bar.style.width = '0%';
      requestAnimationFrame(() => requestAnimationFrame(() => bar.style.width = eff + '%'));
      document.getElementById('modal').classList.add('show');
    }
    function closeModal() { document.getElementById('modal').classList.remove('show'); }

    /* ---------------------------------------------------------
       UTIL
    --------------------------------------------------------- */
    function pulse(el, msg) {
      el.style.borderColor = 'var(--danger)';
      el.style.color = 'var(--danger)';
      el.title = msg;
      setTimeout(() => { el.style.borderColor = '#3a2a52'; el.style.color = '#7f70a7'; el.removeAttribute('title'); }, 600);
    }

    /* Auto-select first demon for convenience */
    document.querySelector('.demon')?.click();
  </script>
</body>

</html>